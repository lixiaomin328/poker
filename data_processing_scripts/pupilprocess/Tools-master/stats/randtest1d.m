function out = randtest1d(a,b,paired,tail,nrand)% function out = randtest1d(a,b,tail,nrand);% tail = 0 (test A~=B), 1 (test A>B), -1 (test A<B)if ~exist('b', 'var'),   b = zeros(size(a)); endif ~exist('nrand', 'var'), nrand = 100000; endif ~exist('tail', 'var'), tail = 0; endif ~exist('paired', 'var'), paired = true; end % paired ttesta = a(:);b = b(:);% subtract the mean per subjectif paired,    alldat = [a b];    alldat = bsxfun(@minus, alldat, mean(alldat, 2));    a = alldat(:, 1);    b = alldat(:, 2);    alldat = [a; b];else    alldat = [a; b];endntra = length(a);ntrb = length(b);meana = mean(a);meanb = mean(b);triala = zeros(1, nrand);trialb = triala;% randomize all the values on each permutationfor irand = 1:nrand,    ind           = randperm(ntra+ntrb); % randomly shuffle all the values    triala(irand) = mean(alldat(ind(1:ntra)));    trialb(irand) = mean(alldat(ind(ntra+1:end)));end% based on the tail, compute our pvalueswitch tail    case 0        out = length(find(abs(triala-trialb) >= abs(meana-meanb)))/nrand;    case {-1,1}        out = length(find(tail*(triala-trialb) >= tail*(meana-meanb)))/nrand;end